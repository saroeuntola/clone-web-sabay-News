;/*FB_PKG_DELIM*/

__d("LSIssueRestoreTask",["LSAppendDataTraceAddon","LSIsMobileClient","LSIssueNewTaskAndGetTaskID","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueRestoreTaskStoredProcedure] Beginning execution."),c.i64.eq(a[3],c.i64.cast([0,1]))?d[1]="messages":d[1]="threads",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueRestoreTaskStoredProcedure] ","",["Restoring ",d[1]].join("")].join("")),a[5]!==f?c.sp(b("LSAppendDataTraceAddon"),a[5],c.i64.cast([0,3604]),c.i64.cast([0,2]),f,f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[2]=a[0],a})},function(a){return d[2]?d[3]=!0:d[3]=!1,d[3]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[18]=c.createArray(),f!==f?d[19]=(d[18].push(f),d[18]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[18],c.i64.cast([0,3]))):c.resolve()},function(e){return a[9]!==f?d[4]=a[9]:d[4]="",c.i64.gt(c.i64.cast([0,0]),c.i64.cast([0,0]))?(d[18]=c.i64.of_float(Date.now()),d[5]=c.i64.add(d[18],c.i64.cast([0,0]))):d[5]=c.i64.cast([0,0]),c.sp(b("LSIssueNewTaskAndGetTaskID"),["encrypted_backups_restore",":",d[4]].join(""),c.i64.cast([0,50015]),"",f,f,c.i64.cast([0,0]),c.i64.cast([0,0]),f,f,d[5]).then(function(a){return a=a,d[6]=a[0],a})},function(d){return a[5]!==f?c.sp(b("LSAppendDataTraceAddon"),a[5],c.i64.cast([0,3601]),c.i64.cast([0,2]),f,f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[7]=a[0],a})},function(a){return d[7]?d[8]=!0:d[8]=!1,d[8]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[18]=c.createArray(),f!==f?d[19]=(d[18].push(f),d[18]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[18],c.i64.cast([0,3]))):c.resolve()},function(b){return c.db.table(190).add({taskId:d[6],mailboxPartialId:a[0],listId:a[1],numItems:a[2],contentType:a[3],startSortKey:a[4],traceId:a[5],isPointQuery:!1,newerNumItems:a[7],unencryptedSortKey:a[8],serverThreadKey:a[9],waThreadId:a[10]})},function(d){return a[5]!==f?c.sp(b("LSAppendDataTraceAddon"),a[5],c.i64.cast([0,3605]),c.i64.cast([0,2]),f,f):c.resolve()},function(a){return c.sp(b("LSIsMobileClient")).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[9]?d[10]=!0:d[10]=!1,d[10]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[18]=c.createArray(),f!==f?d[19]=(d[18].push(f),d[18]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[18],c.i64.cast([0,3]))):c.resolve()},function(a){return d[11]=c.i64.of_float(Date.now()),d[13]="Finishing execution. Execution time: ",d[14]=c.i64.to_string(c.i64.sub(d[11],d[0])),d[16]=" ms",d[12]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueRestoreTaskStoredProcedure] ",d[12],d[13],d[12],d[14],d[12],d[16]].join("")),d[15]=",",d[17]=c.createArray(),f!==f?d[18]=(d[17].push(f),d[17]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueRestoreTaskStoredProcedure",[d[13],d[15],d[14],d[15],d[16]].join(""),d[17],c.i64.cast([0,4]))},function(a){return e[0]=d[6]}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSLoadThreadPkFromThreadId",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadThreadPkFromThreadId] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.ftr(c.db.table(173).fetch(),function(b){return c.i64.to_string(b.jid)===a[0]}).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[14]=new c.Map(),d[14].set("error_code",c.i64.cast([0,100])),d[14].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[14].set("error_message",""),e=[f,d[14]],d[2]=e[0],d[3]=e[1],e):(b=a.item,e=[b.clientThreadPk,f],d[2]=e[0],d[3]=e[1],e)})},function(a){return c.i64.neq(d[2],f)?(a=[d[2],d[3]],d[5]=a[0],d[6]=a[1],a):(d[14]=new c.Map(),d[14].set("error_code",c.i64.cast([0,7])),d[14].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[14].set("error_message",""),c.i64.neq(f,f)?(a=[f,d[14]],d[15]=a[0],d[16]=a[1],a):(d[17]=new c.Map(),d[17].set("error_code",c.i64.cast([0,100])),d[17].set("stored_procedure","LSEncryptedBackupsLoadThreadPkFromThreadIdStoredProcedure"),d[17].set("error_message",""),a=[f,d[17]],d[15]=a[0],d[16]=a[1],a),a=[d[15],d[16]],d[5]=a[0],d[6]=a[1],a),d[7]=c.i64.of_float(Date.now()),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[12]=" ms",d[8]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadThreadPkFromThreadId] ",d[8],d[9],d[8],d[10],d[8],d[12]].join("")),d[11]=",",d[13]=c.createArray(),f!==f?d[14]=(d[13].push(f),d[13]):0,c.nop(b("LSLogMebClientEvent.nop"),"loadThreadPkFromThreadId",[d[9],d[11],d[10],d[11],d[12]].join(""),d[13],c.i64.cast([0,4]))},function(a){return a=[d[5],d[6]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSIssueMessageRangeQueryTask",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSBinaryToHex.nop","LSCreateDataTrace","LSCreateDataTraceID.nop","LSCreateDerivedKeys.nop","LSFlushDataTrace.nop","LSGetBlobFromInt64BE.nop","LSGetBlobFromString.nop","LSGetThreadTransportIdFromThreadId.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewTask","LSIssueRestoreTask","LSLoadThreadPkFromThreadId","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","LSOpeEncrypt.nop","LSTruncateSortKey.nop","gkx","justknobx","qex"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1];d.n;var e=[],f=[],g;return d.seq([function(f){return d.seq([function(f){return e[0]=d.i64.of_float(Date.now()),function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] Beginning execution."),e[10]=function(a){return a==g?g:a}(c("qex")._("9")),e[10]!==g?e[1]=e[10]:e[1]=!1,e[11]=function(a){return a==g?g:a}(c("qex")._("74")),e[11]!==g?e[2]=e[11]:e[2]=!1,!a[3]&&(c("gkx")("1783")||c("gkx")("4805")||e[1]||e[2])?(e[14]=d.i64.gt(a[1],d.i64.cast([0,0]))&&d.i64.gt(a[5],d.i64.cast([0,0])),d.islc(d.ftr(d.db.table(168).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))||!1}),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(c,f){var h=c.done;c=c.value;return h?d.seq([function(c){return e[14]?(e[15]=new d.Map(),e[15].set("error_code",d.i64.cast([0,1])),e[15].set("error_message",""),e[15].set("stored_procedure","issueMessageRangeQueryTask"),e[16]=new d.Map(),e[16].set("act_thread_id",a[0]),e[17]=new d.Map(),e[17].set("restore_context",e[16]),e[17].set("failure",e[15]),e[18]=e[17].get("restore_context"),e[17],e[19]=e[18].get("act_thread_id"),e[18],e[20]=d.toJSON(e[17]),d.sp(b("LSIssueNewTask"),["encrypted_backups_restore",":",e[19]].join(""),d.i64.cast([0,50031]),e[20],g,g,d.i64.cast([0,0]),d.i64.cast([0,0]),g,g,d.i64.cast([0,0]))):(e[15]=new d.Map(),e[15].set("error_code",d.i64.cast([0,1])),e[15].set("error_message",""),e[15].set("stored_procedure","issueMessageRangeQueryTask"),e[16]=new d.Map(),e[16].set("act_thread_id",a[0]),e[17]=new d.Map(),e[17].set("restore_context",e[16]),e[17].set("failure",e[15]),e[18]=e[17].get("restore_context"),e[17],e[19]=e[18].get("act_thread_id"),e[18],e[20]=d.toJSON(e[17]),d.sp(b("LSIssueNewTask"),["encrypted_backups_restore",":",e[19]].join(""),d.i64.cast([0,50030]),e[20],g,g,d.i64.cast([0,0]),d.i64.cast([0,0]),g,g,d.i64.cast([0,0])))},function(a){return e[12]=!1}]):(f=c.item,d.seq([function(a){return e[23]=f.mailboxRootKeyBlob,e[22]=f.ocmfClientStateBlob,e[21]=f.deviceId,e[20]=f.backupTenancy,e[19]=f.encryptionVersion,d.i64.neq(g,g)?d.resolve(e[15]=g):d.seq([function(a){return e[24]=d.createArray(),d.sp(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,0])).then(function(a){return a=a,e[25]=a[0],a})},function(a){return e[25]?e[34]=(e[24].push(d.i64.cast([0,0])),e[24]):0,d.sp(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,2])).then(function(a){return a=a,e[26]=a[0],a})},function(a){return e[26]?e[34]=(e[24].push(d.i64.cast([0,2])),e[24]):0,d.sp(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,3])).then(function(a){return a=a,e[27]=a[0],a})},function(a){return e[27]?e[34]=(e[24].push(d.i64.cast([0,3])),e[24]):0,d.sp(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,4])).then(function(a){return a=a,e[28]=a[0],a})},function(a){return e[28]?e[34]=(e[24].push(d.i64.cast([0,4])),e[24]):0,e[29]=d.createArray(),e[30]=d.i64.of_int32(e[24].length),d.i64.gt(e[30],d.i64.cast([0,0]))?d.loopAsync(e[30],function(a){return e[34]=a,d.seq([function(a){return d.ntop("Array",b("LSArrayGetObjectAt"),e[24],e[34]).then(function(a){return a=a,e[35]=a[0],e[36]=a[1],a})},function(a){return e[37]=(e[29].push(e[35]),e[29])}])}):d.resolve()},function(a){return d.seq([function(a){return e[34]=d.createArray(),e[35]=d.i64.of_int32(e[29].length),d.i64.gt(e[35],d.i64.cast([0,0]))?d.loopAsync(e[35],function(a){return e[37]=a,d.seq([function(a){return d.ntop("Array",b("LSArrayGetObjectAt"),e[29],e[37]).then(function(a){return a=a,e[38]=a[0],e[39]=a[1],a})},function(a){return e[40]=(e[34].push(d.i64.to_string(e[38])),e[34])}])}):d.resolve()},function(a){return e[36]=e[34].join(","),e[31]=e[36]}])},function(a){return e[29].some(function(a){return d.i64.eq(e[19],a)})?e[32]=e[19]:e[32]=g,d.i64.neq(e[32],g)?e[33]=e[32]:e[33]=g,e[15]=e[33]}])},function(c){return d.i64.neq(e[15],g)?e[16]=e[15]:e[16]=d.i64.cast([0,0]),d.i64.neq(e[20],g)?e[17]=e[20]:e[17]=d.i64.cast([0,1]),d.i64.neq(e[21],g)?d.seq([function(c){return d.sp(b("LSLoadThreadPkFromThreadId"),a[0]).then(function(a){return a=a,e[24]=a[0],e[25]=a[1],a})},function(c){return d.i64.neq(e[24],g)?e[14]?d.seq([function(a){return d.nop(b("LSBase64Encode.nop"),e[22]).then(function(a){return a=a,e[26]=a[0],a})},function(a){return d.nop(b("LSBase64Encode.nop"),e[23]).then(function(a){return a=a,e[27]=a[0],a})},function(a){return e[28]=new d.Map(),e[28].set("ocmf_client_state_blob",e[26]==null?"":e[26]),e[28].set("mailbox_root_key",e[27]==null?"":e[27]),e[29]=d.createArray(),d.fe(d.ftr(d.db.table(169).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))}),function(a){a=a.item;return e[40]=(e[29].push(a.epochId),e[29])})},function(c){return e[30]=d.i64.of_int32(e[29].length),e[31]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",e[31],"Queried locally available epochs. Count: ",e[31],d.i64.to_string(e[30])].join("")),e[32]=new d.Map(),e[32].set("device_id",e[21]),e[32].set("raw_tokens",e[28]),e[32].set("locally_available_epochs",e[29]),d.i64.eq(e[17],d.i64.cast([0,3]))?e[33]=d.i64.cast([0,4]):e[33]=d.i64.cast([0,0]),e[34]=new d.Map(),e[34].set("act_thread_id",a[0]),e[34].set("tam_thread_subtype",e[33]),e[35]=new d.Map(),e[35].set("reference_timestamp",a[2]),e[35].set("server_thread_key",g),e[35].set("device_context",e[32]),e[36]=new d.Map(),e[36].set("restore_context",e[34]),e[36].set("success",e[35]),e[37]=e[36].get("restore_context"),e[36],e[38]=e[37].get("act_thread_id"),e[37],e[39]=d.toJSON(e[36]),d.sp(b("LSIssueNewTask"),["encrypted_backups_restore",":",e[38]].join(""),d.i64.cast([0,50031]),e[39],g,g,d.i64.cast([0,0]),d.i64.cast([0,0]),g,g,d.i64.cast([0,0]))}]):d.i64.gt(a[1],d.i64.cast([0,0]))?d.seq([function(a){return d.nop(b("LSBase64Encode.nop"),e[22]).then(function(a){return a=a,e[26]=a[0],a})},function(a){return d.nop(b("LSBase64Encode.nop"),e[23]).then(function(a){return a=a,e[27]=a[0],a})},function(a){return e[28]=new d.Map(),e[28].set("ocmf_client_state_blob",e[26]==null?"":e[26]),e[28].set("mailbox_root_key",e[27]==null?"":e[27]),e[29]=d.createArray(),d.fe(d.ftr(d.db.table(169).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))}),function(a){a=a.item;return e[40]=(e[29].push(a.epochId),e[29])})},function(c){return e[30]=d.i64.of_int32(e[29].length),e[31]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",e[31],"Queried locally available epochs. Count: ",e[31],d.i64.to_string(e[30])].join("")),e[32]=new d.Map(),e[32].set("device_id",e[21]),e[32].set("raw_tokens",e[28]),e[32].set("locally_available_epochs",e[29]),d.i64.eq(e[17],d.i64.cast([0,3]))?e[33]=d.i64.cast([0,4]):e[33]=d.i64.cast([0,0]),e[34]=new d.Map(),e[34].set("act_thread_id",a[0]),e[34].set("request_id",a[4]),e[34].set("tam_thread_subtype",e[33]),e[35]=new d.Map(),e[35].set("reference_timestamp",a[2]),e[35].set("direction",d.i64.cast([0,1])),e[35].set("server_thread_key",g),e[35].set("device_context",e[32]),e[36]=new d.Map(),e[36].set("restore_context",e[34]),e[36].set("success",e[35]),e[37]=e[36].get("restore_context"),e[36],e[38]=e[37].get("act_thread_id"),e[37],e[39]=d.toJSON(e[36]),d.sp(b("LSIssueNewTask"),["encrypted_backups_restore",":",e[38]].join(""),d.i64.cast([0,50030]),e[39],g,g,d.i64.cast([0,0]),d.i64.cast([0,0]),g,g,d.i64.cast([0,0]))}]):d.seq([function(a){return d.nop(b("LSBase64Encode.nop"),e[22]).then(function(a){return a=a,e[26]=a[0],a})},function(a){return d.nop(b("LSBase64Encode.nop"),e[23]).then(function(a){return a=a,e[27]=a[0],a})},function(a){return e[28]=new d.Map(),e[28].set("ocmf_client_state_blob",e[26]==null?"":e[26]),e[28].set("mailbox_root_key",e[27]==null?"":e[27]),e[29]=d.createArray(),d.fe(d.ftr(d.db.table(169).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))}),function(a){a=a.item;return e[40]=(e[29].push(a.epochId),e[29])})},function(c){return e[30]=d.i64.of_int32(e[29].length),e[31]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",e[31],"Queried locally available epochs. Count: ",e[31],d.i64.to_string(e[30])].join("")),e[32]=new d.Map(),e[32].set("device_id",e[21]),e[32].set("raw_tokens",e[28]),e[32].set("locally_available_epochs",e[29]),d.i64.eq(e[17],d.i64.cast([0,3]))?e[33]=d.i64.cast([0,4]):e[33]=d.i64.cast([0,0]),e[34]=new d.Map(),e[34].set("act_thread_id",a[0]),e[34].set("request_id",a[4]),e[34].set("tam_thread_subtype",e[33]),e[35]=new d.Map(),e[35].set("reference_timestamp",a[2]),e[35].set("direction",d.i64.cast([0,2])),e[35].set("server_thread_key",g),e[35].set("device_context",e[32]),e[36]=new d.Map(),e[36].set("restore_context",e[34]),e[36].set("success",e[35]),e[37]=e[36].get("restore_context"),e[36],e[38]=e[37].get("act_thread_id"),e[37],e[39]=d.toJSON(e[36]),d.sp(b("LSIssueNewTask"),["encrypted_backups_restore",":",e[38]].join(""),d.i64.cast([0,50030]),e[39],g,g,d.i64.cast([0,0]),d.i64.cast([0,0]),g,g,d.i64.cast([0,0]))}]):e[14]?(e[26]=new d.Map(),e[26].set("error_code",d.i64.cast([0,100])),e[26].set("error_message",""),e[26].set("stored_procedure","issueMessageRangeQueryTask"),e[27]=new d.Map(),e[27].set("act_thread_id",a[0]),e[28]=new d.Map(),e[28].set("restore_context",e[27]),e[28].set("failure",e[26]),e[29]=e[28].get("restore_context"),e[28],e[30]=e[29].get("act_thread_id"),e[29],e[31]=d.toJSON(e[28]),d.sp(b("LSIssueNewTask"),["encrypted_backups_restore",":",e[30]].join(""),d.i64.cast([0,50031]),e[31],g,g,d.i64.cast([0,0]),d.i64.cast([0,0]),g,g,d.i64.cast([0,0]))):(e[26]=new d.Map(),e[26].set("error_code",d.i64.cast([0,100])),e[26].set("error_message",""),e[26].set("stored_procedure","issueMessageRangeQueryTask"),e[27]=new d.Map(),e[27].set("act_thread_id",a[0]),e[28]=new d.Map(),e[28].set("restore_context",e[27]),e[28].set("failure",e[26]),e[29]=e[28].get("restore_context"),e[28],e[30]=e[29].get("act_thread_id"),e[29],e[31]=d.toJSON(e[28]),d.sp(b("LSIssueNewTask"),["encrypted_backups_restore",":",e[30]].join(""),d.i64.cast([0,50030]),e[31],g,g,d.i64.cast([0,0]),d.i64.cast([0,0]),g,g,d.i64.cast([0,0])))},function(a){return e[18]=!0}]):d.seq([function(c){return e[14]?(e[24]=new d.Map(),e[24].set("error_code",d.i64.cast([0,1])),e[24].set("error_message",""),e[24].set("stored_procedure","issueMessageRangeQueryTask"),e[25]=new d.Map(),e[25].set("act_thread_id",a[0]),e[26]=new d.Map(),e[26].set("restore_context",e[25]),e[26].set("failure",e[24]),e[27]=e[26].get("restore_context"),e[26],e[28]=e[27].get("act_thread_id"),e[27],e[29]=d.toJSON(e[26]),d.sp(b("LSIssueNewTask"),["encrypted_backups_restore",":",e[28]].join(""),d.i64.cast([0,50031]),e[29],g,g,d.i64.cast([0,0]),d.i64.cast([0,0]),g,g,d.i64.cast([0,0]))):(e[24]=new d.Map(),e[24].set("error_code",d.i64.cast([0,1])),e[24].set("error_message",""),e[24].set("stored_procedure","issueMessageRangeQueryTask"),e[25]=new d.Map(),e[25].set("act_thread_id",a[0]),e[26]=new d.Map(),e[26].set("restore_context",e[25]),e[26].set("failure",e[24]),e[27]=e[26].get("restore_context"),e[26],e[28]=e[27].get("act_thread_id"),e[27],e[29]=d.toJSON(e[26]),d.sp(b("LSIssueNewTask"),["encrypted_backups_restore",":",e[28]].join(""),d.i64.cast([0,50030]),e[29],g,g,d.i64.cast([0,0]),d.i64.cast([0,0]),g,g,d.i64.cast([0,0])))},function(a){return e[18]=!1}])},function(a){return e[12]=e[18]}]))})):(c("gkx")("7350")||c("gkx")("4765"))&&c("justknobx")._("1103")?d.seq([function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[12]=a[0],a})},function(c){return e[12]?e[13]=!0:e[13]=!1,e[13]?d.seq([function(c){return a[4]!==g?d.seq([function(a){return d.islc(d.ftr(d.db.table(168).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))&&d.i64.eq(a.backupTenancy,d.i64.cast([0,2]))}),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(a,b){b=a.done;a=a.value;return b?e[33]=!1:(a.item,e[33]=!0)})},function(c){return e[33]?e[35]=d.i64.or_(d.i64.cast([0,73]),d.i64.cast([0,128])):e[35]=d.i64.cast([0,73]),e[36]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",e[36],"EncryptedBackups MCD Trace ID",e[36],d.i64.to_string(e[35])].join("")),d.sp(b("LSCreateDataTrace"),a[4],g,g,"restore_messages",e[35])},function(b){return e[32]=a[4]}]):d.seq([function(a){return d.islc(d.ftr(d.db.table(168).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))&&d.i64.eq(a.backupTenancy,d.i64.cast([0,2]))}),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(a,b){b=a.done;a=a.value;return b?e[33]=!1:(a.item,e[33]=!0)})},function(a){return e[33]?e[35]=d.i64.or_(d.i64.cast([0,73]),d.i64.cast([0,128])):e[35]=d.i64.cast([0,73]),d.nop(b("LSCreateDataTraceID.nop")).then(function(a){return a=a,e[36]=a[0],a})},function(a){return e[37]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",e[37],"EncryptedBackups MCD Trace ID",e[37],d.i64.to_string(e[35])].join("")),d.sp(b("LSCreateDataTrace"),e[36],g,g,"restore_messages",e[35])},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[38]=a[0],a})},function(a){return e[38]?e[39]=!0:e[39]=!1,e[39]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[40]=d.createArray(),g!==g?e[41]=(e[40].push(g),e[40]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[40],d.i64.cast([0,3]))):d.resolve()},function(a){return e[32]=e[36]}])},function(a){return e[14]=e[32]}]):d.seq([function(a){return d.islc(d.ftr(d.db.table(168).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))&&d.i64.eq(a.backupTenancy,d.i64.cast([0,2]))}),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(a,b){b=a.done;a=a.value;return b?e[32]=!1:(a.item,e[32]=!0)})},function(a){return e[32]?e[34]=d.i64.or_(d.i64.cast([0,73]),d.i64.cast([0,128])):e[34]=d.i64.cast([0,73]),d.nop(b("LSCreateDataTraceID.nop")).then(function(a){return a=a,e[35]=a[0],a})},function(a){return e[36]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",e[36],"EncryptedBackups MCD Trace ID",e[36],d.i64.to_string(e[34])].join("")),d.sp(b("LSCreateDataTrace"),e[35],g,g,"restore_messages",e[34])},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[37]=a[0],a})},function(a){return e[37]?e[38]=!0:e[38]=!1,e[38]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[39]=d.createArray(),g!==g?e[40]=(e[39].push(g),e[39]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[39],d.i64.cast([0,3]))):d.resolve()},function(a){return e[14]=e[35]}])},function(a){return e[14]!==g?d.sp(b("LSAppendDataTraceAddon"),e[14],d.i64.cast([0,1421]),d.i64.cast([0,2]),g,g):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[15]=a[0],a})},function(a){return e[15]?e[16]=!0:e[16]=!1,e[16]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[32]=d.createArray(),g!==g?e[33]=(e[32].push(g),e[32]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[32],d.i64.cast([0,3]))):d.resolve()},function(a){return d.islc(d.ftr(d.db.table(168).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))}),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(a,c){var f=a.done;a=a.value;return f?(f=[g,g,g,g,g,d.i64.cast([0,1]),g,g,g,g,g,g,g,d.i64.cast([0,20])],e[17]=f[0],e[18]=f[1],e[19]=f[2],e[20]=f[3],e[21]=f[4],e[22]=f[5],e[23]=f[6],e[24]=f[7],e[25]=f[8],e[26]=f[9],e[27]=f[10],e[28]=f[11],e[29]=f[12],e[30]=f[13],f):(c=a.item,d.seq([function(a){return e[36]=c.backupTenancy,e[35]=c.encryptionVersion,d.i64.neq(g,g)?d.resolve(e[32]=g):d.seq([function(a){return e[37]=d.createArray(),d.sp(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,0])).then(function(a){return a=a,e[38]=a[0],a})},function(a){return e[38]?e[47]=(e[37].push(d.i64.cast([0,0])),e[37]):0,d.sp(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,2])).then(function(a){return a=a,e[39]=a[0],a})},function(a){return e[39]?e[47]=(e[37].push(d.i64.cast([0,2])),e[37]):0,d.sp(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,3])).then(function(a){return a=a,e[40]=a[0],a})},function(a){return e[40]?e[47]=(e[37].push(d.i64.cast([0,3])),e[37]):0,d.sp(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,4])).then(function(a){return a=a,e[41]=a[0],a})},function(a){return e[41]?e[47]=(e[37].push(d.i64.cast([0,4])),e[37]):0,e[42]=d.createArray(),e[43]=d.i64.of_int32(e[37].length),d.i64.gt(e[43],d.i64.cast([0,0]))?d.loopAsync(e[43],function(a){return e[47]=a,d.seq([function(a){return d.ntop("Array",b("LSArrayGetObjectAt"),e[37],e[47]).then(function(a){return a=a,e[48]=a[0],e[49]=a[1],a})},function(a){return e[50]=(e[42].push(e[48]),e[42])}])}):d.resolve()},function(a){return d.seq([function(a){return e[47]=d.createArray(),e[48]=d.i64.of_int32(e[42].length),d.i64.gt(e[48],d.i64.cast([0,0]))?d.loopAsync(e[48],function(a){return e[50]=a,d.seq([function(a){return d.ntop("Array",b("LSArrayGetObjectAt"),e[42],e[50]).then(function(a){return a=a,e[51]=a[0],e[52]=a[1],a})},function(a){return e[53]=(e[47].push(d.i64.to_string(e[51])),e[47])}])}):d.resolve()},function(a){return e[49]=e[47].join(","),e[44]=e[49]}])},function(a){return e[42].some(function(a){return d.i64.eq(e[35],a)})?e[45]=e[35]:e[45]=g,d.i64.neq(e[45],g)?e[46]=e[45]:e[46]=g,e[32]=e[46]}])},function(a){return d.i64.neq(e[32],g)?e[33]=e[32]:e[33]=d.i64.cast([0,0]),d.i64.neq(e[36],g)?e[34]=e[36]:e[34]=d.i64.cast([0,1]),a=[c.backupId,c.deviceId,c.mailboxRootKeyBlob,c.ocmfClientStateBlob,e[33],e[34],c.epochAuthPublicKeyBlob,c.epochAuthPrivateKeyBlob,c.devicePublicKeyBlob,c.devicePrivateKeyBlob,c.epochStoragePublicKeyBlob,c.epochStoragePrivateKeyBlob,c.obliviousValidationTokenBlob,c.authorityLevel],e[17]=a[0],e[18]=a[1],e[19]=a[2],e[20]=a[3],e[21]=a[4],e[22]=a[5],e[23]=a[6],e[24]=a[7],e[25]=a[8],e[26]=a[9],e[27]=a[10],e[28]=a[11],e[29]=a[12],e[30]=a[13],a}]))})},function(c){return d.i64.neq(e[17],g)?d.blobs.neq(e[20],g)?d.seq([function(c){return d.i64.gt(a[1],d.i64.cast([0,0]))&&d.i64.gt(a[5],d.i64.cast([0,0]))?d.seq([function(a){return e[14]!==g?d.sp(b("LSAppendDataTraceAddon"),e[14],d.i64.cast([0,2515]),d.i64.cast([0,2]),g,g):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[45]=a[0],a})},function(a){return e[45]?e[46]=!0:e[46]=!1,e[46]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[47]=d.createArray(),g!==g?e[48]=(e[47].push(g),e[47]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[47],d.i64.cast([0,3]))):d.resolve()}]):d.i64.gt(a[5],d.i64.cast([0,0]))?d.seq([function(a){return e[14]!==g?d.sp(b("LSAppendDataTraceAddon"),e[14],d.i64.cast([0,2514]),d.i64.cast([0,2]),g,g):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[45]=a[0],a})},function(a){return e[45]?e[46]=!0:e[46]=!1,e[46]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[47]=d.createArray(),g!==g?e[48]=(e[47].push(g),e[47]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[47],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(c){return d.nop(b("LSGetBlobFromString.nop"),a[0]).then(function(a){return a=a,e[32]=a[0],a})},function(a){return d.nop(b("LSHmac_v2.nop"),d.blob("dGhyZWFkX2lkX3Njb3Bl"),e[32]).then(function(a){return a=a,e[33]=a[0],a})},function(a){return d.nop(b("LSOcmfClientMap.nop"),e[20],e[33]).then(function(a){return a=a,e[34]=a[0],a})},function(a){return d.nop(b("LSBase64Encode.nop"),e[34]).then(function(a){return a=a,e[35]=a[0],a})},function(a){return e[44]=e[35]==null?"":e[35],d.nop(b("LSGetBlobFromString.nop"),d.i64.to_string(e[17])).then(function(a){return a=a,e[36]=a[0],a})},function(a){return d.nop(b("LSHmac_v2.nop"),d.blob("bWFpbGJveF9pZF9zY29wZQ=="),e[36]).then(function(a){return a=a,e[37]=a[0],a})},function(a){return d.nop(b("LSOcmfClientMap.nop"),e[20],e[37]).then(function(a){return a=a,e[38]=a[0],a})},function(a){return d.nop(b("LSBase64Encode.nop"),e[38]).then(function(a){return a=a,e[39]=a[0],a})},function(c){return d.blobs.neq(e[19],g)?d.seq([function(c){return a[2]!==g?d.seq([function(c){return e[46]=d.createArray(),e[52]=(e[46].push(d.i64.cast([0,32])),e[46]),d.nop(b("LSGetBlobFromString.nop"),["thread_ope_key","_",a[0]].join("")).then(function(a){return a=a,e[47]=a[0],a})},function(a){return d.nop(b("LSCreateDerivedKeys.nop"),e[47],g,e[19],e[46]).then(function(a){return a=a,e[48]=a[0],a})},function(a){return e[48]?e[49]=!1:e[49]=!0,e[49]?d.seq([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),e[52]=d.createArray(),g!==g?e[53]=(e[52].push(g),e[52]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","Got null keys while deriving message list OPE key. Returning null blobish",e[52],d.i64.cast([0,3]))},function(a){return e[50]=g}]):d.seq([function(a){return d.ntop("Array",b("LSArrayGetObjectAt"),e[48],d.i64.cast([0,0])).then(function(a){return a=a,e[52]=a[0],e[53]=a[1],a})},function(a){return e[50]=e[52]}])},function(c){return d.blobs.neq(e[50],g)?d.seq([function(c){return d.nop(b("LSGetBlobFromInt64BE.nop"),d.i64.from_string(a[2])).then(function(a){return a=a,e[52]=a[0],a})},function(a){return d.nop(b("LSTruncateSortKey.nop"),e[52]).then(function(a){return a=a,e[53]=a[0],a})},function(a){return d.nop(b("LSOpeEncrypt.nop"),e[50],e[53],d.i64.cast([0,16])).then(function(a){return a=a,e[54]=a[0],a})},function(a){return d.nop(b("LSBinaryToHex.nop"),e[54]).then(function(a){return a=a,e[55]=a[0],a})},function(a){return e[51]=e[55]==null?"":e[55]}]):d.seq([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] OPE key is null"),e[52]=d.createArray(),g!==g?e[53]=(e[52].push(g),e[52]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","OPE key is null",e[52],d.i64.cast([0,3]))},function(a){return e[51]=g}])},function(a){return e[45]=e[51]}]):d.resolve(e[45]=g)},function(a){return e[40]=e[45]}]):d.seq([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Mailbox root key is null"),e[45]=d.createArray(),g!==g?e[46]=(e[45].push(g),e[45]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","Mailbox root key is null",e[45],d.i64.cast([0,3]))},function(a){return e[40]=g}])},function(c){return a[0]!==g?d.seq([function(c){return d.nop(b("LSGetThreadTransportIdFromThreadId.nop"),a[0]).then(function(a){return a=a,e[45]=a[0],a})},function(a){return d.i64.neq(e[45],g)?d.seq([function(a){return d.db.table(173).fetch([[[e[45]]],"jid"]).next().then(function(a,b){var c=a.done;a=a.value;return c?e[47]=g:(b=a.item,e[47]=d.i64.to_string(b.serverThreadKey))})},function(a){return e[46]=e[47]}]):d.seq([function(a){return function(a){d.logger(a).warn(a)}("[EncryptedBackups][MEBTableUtils] Failed to get server thread key, wa jid is null"),e[47]=d.createArray(),g!==g?e[48]=(e[47].push(g),e[47]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTableUtils","Failed to get server thread key, wa jid is null",e[47],d.i64.cast([0,2]))},function(a){return e[46]=g}])},function(a){return e[41]=e[46]}]):d.seq([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTableUtils] Failed to get server thread key, thread id is null"),e[45]=d.createArray(),g!==g?e[46]=(e[45].push(g),e[45]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTableUtils","Failed to get server thread key, thread id is null",e[45],d.i64.cast([0,3]))},function(a){return e[41]=g}])},function(c){return d.nop(b("LSGetThreadTransportIdFromThreadId.nop"),a[0]).then(function(a){return a=a,e[42]=a[0],a})},function(c){return d.sp(b("LSIssueRestoreTask"),e[39]==null?"":e[39],e[44],a[1],d.i64.cast([0,1]),e[40],e[14],a[3],a[5],a[2],e[41],e[42]).then(function(a){return a=a,e[43]=a[0],a})},function(b){return d.i64.neq(e[43],g)?d.db.table(180).add({taskId:e[43],listId:e[44],threadId:a[0]}):d.resolve()}]):(e[32]="Missing ocmf_client_state for IssueMessageRangeQueryTask",e[32]!==g?d.seq([function(a){return e[36]=["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",e[32]].join(""),function(a){d.logger(a).mustfix(a)}(e[36]),e[33]=d.createArray(),e[14]!==g?e[37]=(e[33].push(e[14]),e[33]):0,d.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",e[32],e[33],d.i64.cast([0,3]))},function(a){return e[14]!==g?d.seq([function(a){return e[14]!==g?d.sp(b("LSAppendDataTraceAddon"),e[14],d.i64.cast([0,85]),d.i64.cast([0,2]),e[36],g):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[37]=a[0],a})},function(a){return e[37]?e[38]=!0:e[38]=!1,e[38]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[39]=d.createArray(),g!==g?e[40]=(e[39].push(g),e[39]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[39],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(a){return e[14]!==g?d.nop(b("LSFlushDataTrace.nop"),e[14]):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[34]=a[0],a})},function(a){return e[34]?e[35]=!0:e[35]=!1,e[35]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[37]=d.createArray(),g!==g?e[38]=(e[37].push(g),e[37]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[37],d.i64.cast([0,3]))):d.resolve()}]):d.seq([function(a){return e[14]!==g?d.seq([function(a){return e[14]!==g?d.sp(b("LSAppendDataTraceAddon"),e[14],d.i64.cast([0,85]),d.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",""].join(""),g):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[35]=a[0],a})},function(a){return e[35]?e[36]=!0:e[36]=!1,e[36]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[37]=d.createArray(),g!==g?e[38]=(e[37].push(g),e[37]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[37],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(a){return e[14]!==g?d.nop(b("LSFlushDataTrace.nop"),e[14]):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[33]=a[0],a})},function(a){return e[33]?e[34]=!0:e[34]=!1,e[34]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[35]=d.createArray(),g!==g?e[36]=(e[35].push(g),e[35]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[35],d.i64.cast([0,3]))):d.resolve()}])):(e[32]="Missing backup_id for IssueMessageRangeQueryTask",e[32]!==g?d.seq([function(a){return e[36]=["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",e[32]].join(""),function(a){d.logger(a).mustfix(a)}(e[36]),e[33]=d.createArray(),e[14]!==g?e[37]=(e[33].push(e[14]),e[33]):0,d.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",e[32],e[33],d.i64.cast([0,3]))},function(a){return e[14]!==g?d.seq([function(a){return e[14]!==g?d.sp(b("LSAppendDataTraceAddon"),e[14],d.i64.cast([0,85]),d.i64.cast([0,2]),e[36],g):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[37]=a[0],a})},function(a){return e[37]?e[38]=!0:e[38]=!1,e[38]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[39]=d.createArray(),g!==g?e[40]=(e[39].push(g),e[39]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[39],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(a){return e[14]!==g?d.nop(b("LSFlushDataTrace.nop"),e[14]):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[34]=a[0],a})},function(a){return e[34]?e[35]=!0:e[35]=!1,e[35]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[37]=d.createArray(),g!==g?e[38]=(e[37].push(g),e[37]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[37],d.i64.cast([0,3]))):d.resolve()}]):d.seq([function(a){return e[14]!==g?d.seq([function(a){return e[14]!==g?d.sp(b("LSAppendDataTraceAddon"),e[14],d.i64.cast([0,85]),d.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",""].join(""),g):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[35]=a[0],a})},function(a){return e[35]?e[36]=!0:e[36]=!1,e[36]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[37]=d.createArray(),g!==g?e[38]=(e[37].push(g),e[37]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[37],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(a){return e[14]!==g?d.nop(b("LSFlushDataTrace.nop"),e[14]):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[33]=a[0],a})},function(a){return e[33]?e[34]=!0:e[34]=!1,e[34]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[35]=d.createArray(),g!==g?e[36]=(e[35].push(g),e[35]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[35],d.i64.cast([0,3]))):d.resolve()}]))}]):(e[12]="paged restore is disabled",e[12]!==g?d.seq([function(c){return e[16]=["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",e[12]].join(""),function(a){d.logger(a).mustfix(a)}(e[16]),e[13]=d.createArray(),a[4]!==g?e[17]=(e[13].push(a[4]),e[13]):0,d.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",e[12],e[13],d.i64.cast([0,3]))},function(c){return a[4]!==g?d.seq([function(c){return a[4]!==g?d.sp(b("LSAppendDataTraceAddon"),a[4],d.i64.cast([0,85]),d.i64.cast([0,2]),e[16],g):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[17]=a[0],a})},function(a){return e[17]?e[18]=!0:e[18]=!1,e[18]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[19]=d.createArray(),g!==g?e[20]=(e[19].push(g),e[19]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[19],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(c){return a[4]!==g?d.nop(b("LSFlushDataTrace.nop"),a[4]):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[14]=a[0],a})},function(a){return e[14]?e[15]=!0:e[15]=!1,e[15]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[17]=d.createArray(),g!==g?e[18]=(e[17].push(g),e[17]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[17],d.i64.cast([0,3]))):d.resolve()}]):d.seq([function(c){return a[4]!==g?d.seq([function(c){return a[4]!==g?d.sp(b("LSAppendDataTraceAddon"),a[4],d.i64.cast([0,85]),d.i64.cast([0,2]),["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ","",""].join(""),g):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[15]=a[0],a})},function(a){return e[15]?e[16]=!0:e[16]=!1,e[16]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[17]=d.createArray(),g!==g?e[18]=(e[17].push(g),e[17]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[17],d.i64.cast([0,3]))):d.resolve()}]):d.resolve()},function(c){return a[4]!==g?d.nop(b("LSFlushDataTrace.nop"),a[4]):d.resolve()},function(a){return d.sp(b("LSIsMobileClient")).then(function(a){return a=a,e[13]=a[0],a})},function(a){return e[13]?e[14]=!0:e[14]=!1,e[14]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[15]=d.createArray(),g!==g?e[16]=(e[15].push(g),e[15]):0,d.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[15],d.i64.cast([0,3]))):d.resolve()}]))},function(a){return e[3]=d.i64.of_float(Date.now()),e[5]="Finishing execution. Execution time: ",e[6]=d.i64.to_string(d.i64.sub(e[3],e[0])),e[8]=" ms",e[4]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure] ",e[4],e[5],e[4],e[6],e[4],e[8]].join("")),e[7]=",",e[9]=d.createArray(),g!==g?e[12]=(e[9].push(g),e[9]):0,d.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueMessageRangeQueryTaskStoredProcedure",[e[5],e[7],e[6],e[7],e[8]].join(""),e[9],d.i64.cast([0,4]))}])},function(a){return d.resolve(f)}])}d=a;g["default"]=d}),98);
__d("MAWUIThreadCache",["MAWBridgeSendAndReceive","Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=new Map();function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.threadId;if(h.has(a))return b("Promise").resolve(h.get(a));var c=(yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","getThreadJidByChatId",{threadId:a}));c!=null&&h.set(a,c);return c});return i.apply(this,arguments)}g.getThreadJidByChatId=a}),98);
__d("MWEncryptedBackupsIssueRangeQuery.bs",["I64","LSEncryptedBackupsBackupTenancy","LSFactory","LSIntEnum","LSIssueMessageRangeQueryTask","MAWEncryptedBackupUtils","MAWJidUtils","MAWUIThreadCache","Promise","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a,e,f,g,h){if(c("gkx")("7110")){c("promiseDone")(d("MAWEncryptedBackupUtils").getBackupTenancy(a).then(function(i){if(i!=null&&d("I64").equal(i,d("LSIntEnum").ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION)))return d("MAWUIThreadCache").getThreadJidByChatId({threadId:e}).then(function(e){if(e==null)return b("Promise").resolve();else return a.runInTransaction(function(a){return c("LSIssueMessageRangeQueryTask")(d("MAWJidUtils").threadIdForChatJid(e),g,d("I64").to_string(f),!1,void 0,h,c("LSFactory")(a))},"readwrite")});else return b("Promise").resolve()}));return}}g.runQuery=a}),98);